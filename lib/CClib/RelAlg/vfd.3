.\" #ident "@(#) /sable/sdb/ra/sblib/vfd/s.vfd.3"
.\"
.PH "'VFD(3SB)'SBLIB C++ Library'VFD(3SB)'"
.PF "'09/91'All Rights Reserved'Page %'"
.OF "'ra2'Copyright \(co 1991 AT&T'ra910000'"
.EF "'ra2'Copyright \(co 1991 AT&T'ra910000'"
.SK
.VL 7 0
.LI "\fBNAME\fP"
.br
Vfd, Vfile - classes for virtual files
.LI "\fBSYNOPSIS\fP"
.br
.EX
\#include <sblib.h>

.SO vfd.dd

.SO vfile.dd
.EE
.LI "\fBDESCRIPTION\fP"
.br 
The Vfd (virtual file descriptor) class allows you to use more files than 
allowed by the system tuneable NOFILES (see /etc/master.d/kernel).
These files may be accessed as file descriptors through \fBVfd::fd()\fP.
.P
Vfd objects with open files are normally kept on an age-sorted list.  If a Vfd
with an open file is referenced,
access is immediate.  If a Vfd with a closed file is referenced and there 
are available file descriptors, the file is opened and then accessed.  If 
there are too many open files, the least-recently used Vfd on the 
age-sorted list closes its file to make room for the referenced Vfd.  The
offset into the closed file is saved and is restored when the file is reopened.
.P
Certain operations such as record and file locking don't work properly if a
Vfd object is closed unexpectedly.  The \fBVfd::notavail()\fP operation can be
used to exempt these objects from the age-sorted list.  The \fBVfd::avail()\fP
operation makes them available to be put on the age-sorted list again.
By default, objects are made available.
.P
Currently the Vfd class allows 6 Vfd objects to be open at one time.
.P
The Vfile (virtual FILE *) class is derived from class Vfd.  It allows you
to use a FILE * rather than a file descriptor.  As with Vfd, Vfile allows you
to have more than NOFILES files open.  Although \fBVfd::avail()\fP and
\fBVfd::notavail()\fP can be used with Vfiles, there can be problems with
record locking.  It is recommended that only file locking be used with Vfiles.
.LI "\fBDIAGNOSTICS\fP"
.br
The \*(Vd operations can fail due to the failure of underlying system calls
or stdio calls.  In that case they will call syserr.error() with an appropriate
message and may abort.
.LI "\fBEXAMPLES\fP"
.br
.EX
.SO vfdE.ex
.EE
.LI "\fBWARNINGS\fP"
.br 
If the parameter name is allowed to default, a file will be created in 
/usr/tmp using a name generated by tmpnam(3S).  This file will be unlinked
by the destructor.
.P
Use the \fBnotavail()\fP function if you plan to lock the file.
.LI "\fBSEE ALSO\fP"
.br
open(2), fopen(3S)
.LE
